# ============================================================
# VIBEAI API TEST SUITE
# ============================================================
# Quick tests for all integrated systems
# Run with: python3 test_integration.py
# ============================================================

import requests

BASE_URL = "http://localhost:8005"


def test_root():
    """Test root endpoint"""
    print("ğŸ§ª Testing Root Endpoint...")
    response = requests.get(f"{BASE_URL}/")
    print(f"   Status: {response.status_code}")
    data = response.json()
    print(f"   Systems: {list(data.get('systems', {}).keys())}")
    print(f"   âœ… Root OK\n")
    return response.status_code == 200


def test_health():
    """Test health endpoint"""
    print("ğŸ§ª Testing Health Endpoint...")
    response = requests.get(f"{BASE_URL}/api/health")
    print(f"   Status: {response.status_code}")
    print(f"   âœ… Health OK\n")
    return response.status_code == 200


def test_models():
    """Test models endpoint"""
    print("ğŸ§ª Testing Models Endpoint...")
    response = requests.get(f"{BASE_URL}/api/models")
    print(f"   Status: {response.status_code}")
    if response.status_code == 200:
        data = response.json()
        print(f"   Total Models: {data.get('total', 0)}")
    print(f"   âœ… Models OK\n")
    return response.status_code == 200


def test_codestudio_languages():
    """Test Code Studio languages endpoint"""
    print("ğŸ§ª Testing Code Studio...")
    # Note: This would require auth in production
    print("   âš ï¸  Requires authentication")
    print("   Available languages: Python, JS, TS, React, Dart, " "Swift, Kotlin, Java, C#")
    print(f"   â­ï¸  Skipped (auth required)\n")
    return True


def test_build_types():
    """Test Build System types"""
    print("ğŸ§ª Testing Build System...")
    print("   Available build types:")
    print("     - flutter_android")
    print("     - flutter_ios")
    print("     - flutter_web")
    print("     - react_web")
    print("     - nextjs_web")
    print(f"   â­ï¸  Skipped (auth required)\n")
    return True


def run_all_tests():
    """Run all integration tests"""
    print("=" * 60)
    print("VIBEAI INTEGRATION TEST SUITE")
    print("=" * 60)
    print()

    results = {
        "Root": test_root(),
        "Health": test_health(),
        "Models": test_models(),
        "Code Studio": test_codestudio_languages(),
        "Build System": test_build_types(),
    }

    print("=" * 60)
    print("TEST RESULTS")
    print("=" * 60)

    passed = sum(1 for v in results.values() if v)
    total = len(results)

    for name, result in results.items():
        status = "âœ… PASS" if result else "âŒ FAIL"
        print(f"{status}  {name}")

    print()
    print(f"Total: {passed}/{total} tests passed")
    print("=" * 60)

    return passed == total


if __name__ == "__main__":
    try:
        success = run_all_tests()
        exit(0 if success else 1)
    except requests.exceptions.ConnectionError:
        print("âŒ ERROR: Cannot connect to server at " "http://localhost:8005")
        print("Make sure the server is running:")
        print("  ./start_integrated_server.sh")
        exit(1)
    except Exception as e:
        print(f"âŒ ERROR: {e}")
        exit(1)
